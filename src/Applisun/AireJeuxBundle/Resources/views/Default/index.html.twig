{% extends "ApplisunAireJeuxBundle::layout.html.twig" %}

{% block title 'Airejeux.com: site de référencement des aires de jeux publiques' %}
    {% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
{% endblock %} 

    {% block content %}
        <div class="row">
                <form id="form-city" class="col-lg-12" action={{ path('ville_search') }} method="get" class="navbar-form navbar-right inline-form"  novalidate>
                      <div class="form-group nomargin">
                          <div class="inner-addon right-addon">
                              <i class="glyphicon glyphicon-search"></i>
                              <input type="search" class="input-md form-control completion" placeholder="Rechercher une ville" name="query" value='{{ app.request.get('query') }}' id="applisun_aire_form_ville" />
                              <!--<input class="input-md" type="submit" value="rechercher" />-->
                          </div>    
                      </div>
                </form>
        </div>                      
        <div id="box" class="row">                      
                <div class="col-lg-12" id="map"><img src="{{ asset('bundles/applisunairejeux/images/ui-anim_basic_16x16.gif') }}" /> </div>
        </div>
        
                    <div id="closest_playground" class="row">
                         <button id="closest_button" class="btn btn-lg btn-blue center-block hidden-xs">Voir les aires de jeux proches de votre position</button>
                    </div>
    {% endblock %}
    {% block javascripts %}
    {{ parent() }}
    <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
    <script src="{{ asset('bundles/fosjsrouting/js/router.js') }}"></script>
    <script src="{{ path('fos_js_routing_js', {'callback': 'fos.Router.setData'}) }}"></script>
    <script src="{{ asset('bundles/applisunairejeux/js/autocompletion.js') }}" type="text/javascript"></script>
    <script src="http://code.highcharts.com/maps/highmaps.js"></script>
    <script src="http://code.highcharts.com/maps/modules/exporting.js"></script>
    <script src="http://code.highcharts.com/mapdata/countries/fr/fr-all-all.js"></script>
    <script type="text/javascript">
        {{ chart(carte) }}
            
        $('#closest_button').on('click', function(){
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(successPosition);
        } else { 
            $('#closest_playground').html("La géolocalisation n'est pas supporté par votre navigateur");
        }
    });
        
        $(function() {
            var newh = $("#box").height();

            $( window ).resize(function() {

                newh = $("#box").height();
                $('#map').highcharts().reflow();
                $('#map').highcharts().reflow();
            });
        });
    
    function successPosition(position) {
        $('#closest_playground').html('<div class="text-center"><img src="{{ asset('bundles/applisunairejeux/images/ui-anim_basic_16x16.gif') }}" /></div>');
        $.ajax({
                url: Routing.generate('aire_near', { latitude: position.coords.latitude, longitude: position.coords.longitude, perimeter: 0.02 }),
                type: "GET",
                        dataType: "html",
                        success: function (response, statut) {
                            $('#closest_playground').html(response);
                            $('#closest_button').addClass('hide');
                        },
                        error: function (){
                            $('#closest_playground').html('erreur');
                            $('#closest_button').addClass('hide');
                        }
        });
        }
    </script>  
{% endblock %}
