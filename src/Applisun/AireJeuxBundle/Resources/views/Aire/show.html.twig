{% extends "ApplisunAireJeuxBundle::layout.html.twig" %}

{% block title %}
     Aire de jeux : {{aire.nom }}
{% endblock %}
{% block meta %}
    <meta name="description" content="AireJeux : {{ aire.nom }} à {{ aire.ville.nom }}">  
    <meta content="{{ app.request.uri }}" property="og:url">
    <meta content="{{ aire.nom }}" property="og:title">
    <meta content="AireJeux : {{ aire.nom }} à {{ aire.ville.nom }}" property="og:description">
    <meta content="{{ asset('uploads/aires/100-'~aire.filename) }}" property="og:image">
{% endblock %}
{% block content %}
    {{ breadcrumb(aire) }}
    <div class="row">
        <h1>{{ aire.nom }}</h1>
        <h5>Ajouté le {{ aire.createdat|date('d-m-Y') }} par {{ aire.user.username }}</h5>
        <div class="col-sm-1 col-lg-1 col-md-2 col-xs-2"> 
            <div class="row">
                        <div class="col-xs-12">
                            <a href="https://www.facebook.com/sharer/sharer.php?u={{ app.request.uri }}" class="btn btn-primary btn-circle" target="_blank">
                                <i class="fa fa-facebook"></i>
                            </a>
                        </div>
                        <div class="col-xs-12">
                            <a href="" class="btn btn-primary btn-circle"><i class="fa fa-twitter"></i></a>
                        </div>
                        <div class="col-xs-12">
                            <a href="" class="btn btn-danger btn-circle"><i class="fa fa-google-plus"></i></a>
                        </div>
                    </div>  
        </div>    
        <div id="img_playground" class="col-sm-8 col-lg-8 col-md-10 col-xs-10">            
                <img class="img-responsive" 
                     src="{% if aire.filename %} 
                            {{ asset('uploads/aires/500-'~aire.filename) }} 
                          {% else %} 
                            {{ asset('bundles/applisunairejeux/images/imagedefaut.png') }} 
                          {% endif %}"/>
                <span class="score">
                    {{ displayAverage(aire.average) }}
                    
                    <i>({{ aire.votes | length }} votes)</i>
                </span>
        </div>
                <div id="share_playground" class="col-sm-3 col-lg-3 col-md-12 col-xs-12">
                    <div class="row nomargin">
                        <div class="col-sm-12 col-lg-12 col-md-3 
                            {% if is_granted('ROLE_USER') %}
                                {% if is_granted('USER_CAN_VOTE', aire) %}
                                    col-xs-6 ">
                                    {% include 'ApplisunAireJeuxBundle:Form:_voteForm.html.twig' with {'form': formVote} %}
                                {% else %}
                                    col-xs-3 ">
                                    <a href="#" class="btn btn-default btn-block"><span class="hidden-xss">Vous avez <br></span> déjà voté</a>
                                {% endif %}   
                            {% else %}
                                col-xs-3 ">
                                <a href="{{path ('fos_user_security_login') }}" class="btn btn-default btn-block"><span class="glyphicon glyphicon-star"></span><br><span class="hidden-xss">Voter</span></a>
                            {% endif %}
                        </div>
                        <div class="col-sm-12 col-lg-12  col-md-3 col-xs-3 ">
                            <a href="#comment" class="btn btn-blue btn-block"><span class="glyphicon glyphicon-comment"></span> {{ aire.comments|length }}<br><span class="hidden-xss">Commenter</span></a> 
                        </div>                    
                        {% if is_granted('ROLE_ADMIN') or (is_granted('ROLE_USER') and is_granted('USER_CAN_AIRE_MODIFY', aire)) %}
                            <div class="col-sm-12 col-lg-12 col-md-3 col-xs-3 ">
                                <a class="btn btn-warning btn-block" href="{{ path('aire_edit', {'id': aire.id}) }}"><span class="glyphicon glyphicon-pencil"></span><br><span class="hidden-xss">Modifier</span></a>
                            </div>
                            <div class="col-sm-12 col-lg-12 col-md-3 col-xs-3 ">
                                <a class="btn btn-danger btn-block" href="{{ path('aire_delete', {'id': aire.id}) }}"><span class="glyphicon glyphicon-remove-sign"></span><br><span class="hidden-xss">Supprimer</span></a>
                            </div> 
                        {% endif %}
                    </div>        
                </div>
    </div>            
    <div class="row nomargin">
        <h3 class="p-bottom">Informations générales:</h3>
        <div id="caract" class="col-sm-6 col-xs-12 nopadding">    
            
            <div class="row">
                <div class="col-xs-12">
                    <div class="row">
                        <div class="col-xs-6 text_caract">
                            Departement:
                        </div>
                        <div class="col-xs-6 value_caract">
                            {{ aire.ville.departement.nom }}
                        </div>
                    </div>    
                    <div class="row">
                        <div class="col-xs-6 text_caract">
                            Ville: 
                        </div>
                        <div class="col-xs-6 value_caract">    
                            {{ aire.ville.nom }}
                        </div>
                    </div>    
                    <div class="row">
                        <div class="col-xs-6 text_caract">
                            Surface: 
                        </div>
                        <div class="col-xs-6 value_caract">    
                        {{ aire.displayedSurface }}
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-6 text_caract">
                            age: 
                        </div> 
                        <div class="col-xs-6 value_caract">
                            {{ aire.ageMin }} à {{ aire.ageMax }} ans
                        </div>    
                    </div> 
                </div>
            </div>
             <div class="row picto nomargin"> 
                        <div class="col-xs-3">
                            <div class=" nbjeux text-center nopadding">
                                <span class="number_game">{{ aire.nbrJeux }}</span>
                                <span class="text_game"> jeux </span>
                            </div>
                        </div>
                        <div class="col-xs-3">
                            {%if aire.isPicnic %}
                                <img src="{{ asset('bundles/applisunairejeux/images/picnic_on.png') }}" alt="Aire de pique-nique" title="Aire de pique-nique" />
                            {%else%}
                                <img class="picto-opacity" src="{{ asset('bundles/applisunairejeux/images/picnic_off.png') }}" alt="Pas d'aire de pique-nique" title="Pas d'aire de pique-nique" />
                            {%endif%} 
                        </div>
                        <div class="col-xs-3">
                            {%if aire.isSport %}
                                <img src="{{ asset('bundles/applisunairejeux/images/sport_on.png') }}" alt="Equipements sportifs" title="Equipements sportifs" />
                            {%else%}
                                <img class="picto-opacity" src="{{ asset('bundles/applisunairejeux/images/sport_off.png') }}" alt="Aucun équipement sportif" title="Aucun équipement sportif" />
                            {%endif%} 
                        </div>
                        <div class="col-xs-3">
                            {%if aire.isShadow %}
                                <img src="{{ asset('bundles/applisunairejeux/images/shadow_on.png') }}" alt=">Ombre" title="Ombre" />
                            {%else%}
                                <img class="picto-opacity" src="{{ asset('bundles/applisunairejeux/images/shadow_off.png') }}" alt=">Pas d'ombre" title="Pas d'ombre" />
                            {%endif%} 
                        </div>
                    </div>
            </div>
         
        <div id="map-canvas" class="col-sm-5 col-xs-12">
            <img src="{{ asset('bundles/applisunairejeux/images/ui-anim_basic_16x16.gif') }}" />           
        </div> 
    </div>  
    {% if aire.description %}
        <div class="row nomargin">
            <h3 class="p-bottom">Informations complémentaires:</h3>
            <p>{{ aire.description }}</p>
        </div>
    {% endif %}    
<div id="comment" class="row">
    <div class="col-xs-12">
        <h3 class="nomargin p-bottom">Commentaires</h3>
    </div>    
    {% if is_granted('ROLE_USER') %}
        {% if is_granted('USER_CAN_COMMENT', aire) %}
            <div id="comment-form" class="col-xs-10 col-xs-push-1">
            {% include 'ApplisunAireJeuxBundle:Form:_commentForm.html.twig' with {'form': formComment} %} 
            </div>
        {% endif %}
    {% endif %}
    <div class="col-xs-12">
        {{ render(controller('ApplisunAireJeuxBundle:Comment:show', {'aire_id': aire.id, 'page': 1})) }}
    </div>
</div>

{% if aire.comments|length > 5 %}
    <button id="more_comment"class="btn btn-block btn-blue">
        <span class="glyphicon glyphicon-plus-sign"></span> Plus de commentaire
    </button> 
{% endif %}    
{% endblock %}
{% block javascripts %}
    {{ parent() }}
    <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
    <script src="{{ asset('bundles/fosjsrouting/js/router.js') }}"></script>
    <script src="{{ path('fos_js_routing_js', {'callback': 'fos.Router.setData'}) }}"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key={{ googlemapkey }}"></script>
    <script>
                var page_num = 2;
                var nb_comment = {{ aire.comments|length }};
                jQuery(document).ready(function () {
        $('#more_comment').on('click', function(evt){
        evt.preventDefault();
                $('#more_comment').html('<img src="{{ asset('bundles/applisunairejeux/images/ui-anim_basic_16x16.gif') }}" />');
                $.ajax({
                url: Routing.generate('comment_show', { aire_id:{{ aire.id }}, page: page_num }),
                        dataType: "html",
                        success: function (response, statut) {
                        page_num++;
                                $('#more_comment').html('<span class="glyphicon glyphicon-plus-sign"></span> Plus de commentaire');
                                if ((nb_comment / page_num) < 5){
                        $('#more_comment').addClass('hide');
                        }
                        $('#plus').append(response);
                        },
                        error: function (){
                        $('#plus').append('erreur');
                        }
                });
        });
        });

        {{ googlemaps(pos) }}
    </script>
{% endblock %}    
